(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const D="modulepreload",I=function(i){return"/"+i},_={},d=function(e,t,o){let r=Promise.resolve();if(t&&t.length>0){let R=function(c){return Promise.all(c.map(m=>Promise.resolve(m).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),l=n?.nonce||n?.getAttribute("nonce");r=R(t.map(c=>{if(c=I(c),c in _)return;_[c]=!0;const m=c.endsWith(".css"),h=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const u=document.createElement("link");if(u.rel=m?"stylesheet":D,m||(u.as="script"),u.crossOrigin="",u.href=c,l&&u.setAttribute("nonce",l),document.head.appendChild(u),m)return new Promise((O,S)=>{u.addEventListener("load",O),u.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return r.then(n=>{for(const l of n||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},M=(i,e,t)=>{const o=i[e];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((r,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};class E{lyricsBox;lyricsText;audioEl;timeDisplay;timedLyrics=[];currentIdx=0;constructor(e,t,o,r){this.lyricsBox=e,this.lyricsText=t,this.audioEl=o,this.timeDisplay=r,this.audioEl.addEventListener("timeupdate",()=>this.handleTimeUpdate()),this.audioEl.addEventListener("loadedmetadata",()=>this.handleMetadataLoaded())}setLyrics(e){this.timedLyrics=e.map(t=>({start:this.parseTime(t.start),line:t.line||t.text||""})),this.currentIdx=0,this.lyricsText.innerHTML="",this.renderLyrics(0)}show(){this.lyricsBox.classList.add("show")}parseTime(e){if(typeof e=="number")return e;const t=e.split(":");if(t.length===2){const o=parseInt(t[0],10),r=parseInt(t[1],10);return o*60+r}return parseInt(e,10)}formatTime(e){const t=Math.floor(e/60),o=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}handleTimeUpdate(){this.updateLyricByTime(this.audioEl.currentTime);const e=this.formatTime(this.audioEl.currentTime),t=this.formatTime(this.audioEl.duration||0);this.timeDisplay.textContent=`${e} / ${t}`}handleMetadataLoaded(){const e=this.formatTime(this.audioEl.duration||0);this.timeDisplay.textContent=`00:00 / ${e}`}updateLyricByTime(e){let t=this.currentIdx;for(;t+1<this.timedLyrics.length&&e>=this.timedLyrics[t+1].start;)t+=1;for(;t>0&&e<this.timedLyrics[t].start;)t-=1;t!==this.currentIdx&&(this.currentIdx=t,this.renderLyrics(this.currentIdx))}renderLyrics(e){this.lyricsText.children.length===0&&this.timedLyrics.forEach((t,o)=>{const r=document.createElement("div");r.className="lyrics-line",r.textContent=t.line,r.style.cursor="pointer",r.addEventListener("click",s=>{s.stopPropagation(),this.seekToLine(o)}),this.lyricsText.appendChild(r)}),this.timedLyrics.forEach((t,o)=>{const r=this.lyricsText.children[o],s=o-e;this.renderLyricsLine(r,s)})}seekToLine(e){if(e>=0&&e<this.timedLyrics.length){const t=this.timedLyrics[e].start;this.audioEl.currentTime=t,this.currentIdx=e,this.renderLyrics(e),console.log(`Seeking to line ${e+1}: "${this.timedLyrics[e].line}" at ${t.toFixed(2)}s`)}}renderLyricsLine(e,t){e.classList.remove("lyrics-line--prev","lyrics-line--current","lyrics-line--next","lyrics-line--next-2","lyrics-line--hidden-above","lyrics-line--hidden-below"),t===-1?e.classList.add("lyrics-line--prev"):t===0?e.classList.add("lyrics-line--current"):t===1?e.classList.add("lyrics-line--next"):t===2?e.classList.add("lyrics-line--next-2"):t>2?e.classList.add("lyrics-line--hidden-below"):t<-1&&e.classList.add("lyrics-line--hidden-above")}}const A=Object.freeze(Object.defineProperty({__proto__:null,LyricsManager:E},Symbol.toStringTag,{value:"Module"})),y=document.querySelector(".canvas");if(!y)throw new Error("Canvas element not found");const f=y.getContext("2d");if(!f)throw new Error("2D context unavailable");const a=document.querySelector(".lyrics-box"),v=document.querySelector(".lyrics-box__text"),w=document.getElementById("carol-audio"),T=document.querySelector(".media-bar"),b=document.querySelector(".media-bar__time-display");if(!a||!v||!w||!T||!b)throw new Error("Required DOM elements are missing");const p=new E(a,v,w,b);let g=!1;document.body.addEventListener("click",i=>{const e=i.target;g||e.closest(".lyrics-box")||e.closest(".media-bar")||e.closest(".room-switcher")||(g=!0,document.body.classList.add("activated"))});(async()=>{const i=document.body.getAttribute("data-song")||"hark-herald-angels";try{const e=await M(Object.assign({"./lyrics/LyricsManager.ts":()=>d(()=>Promise.resolve().then(()=>A),void 0),"./lyrics/hark-herald-angels.ts":()=>d(()=>import("./hark-herald-angels-D6M9p0OF.js"),[]),"./lyrics/joy-to-the-world.ts":()=>d(()=>import("./joy-to-the-world-CpE3tPhq.js"),[]),"./lyrics/o-come-all-ye-faithful.ts":()=>d(()=>import("./o-come-all-ye-faithful-CUI2fTbu.js"),[]),"./lyrics/o-come-o-come-emmanuel.ts":()=>d(()=>import("./o-come-o-come-emmanuel-B3sR2qQG.js"),[])}),`./lyrics/${i}.ts`,3);p.setLyrics(e.default)}catch(e){console.error(`Failed to load lyrics for song: ${i}`,e)}})();a.addEventListener("click",i=>i.stopPropagation());T.addEventListener("click",i=>i.stopPropagation());let L=!1,x=0,P=0;a.addEventListener("mousedown",i=>{if(i.target.closest(".lyrics-box__text"))return;L=!0;const e=a.getBoundingClientRect();x=i.clientX-e.left,P=i.clientY-e.top,a.style.transition="none"});document.addEventListener("mousemove",i=>{L&&(a.style.left=`${i.clientX-x}px`,a.style.top=`${i.clientY-P}px`,a.style.transform="scale(1.5)")});document.addEventListener("mouseup",()=>{L&&(L=!1,a.style.transition="")});async function $(){const i=document.body.className;try{if(i.includes("room-twilight")){const{initRoom2:e}=await d(async()=>{const{initRoom2:t}=await import("./room-twilight-DH2JXfSA.js");return{initRoom2:t}},[]);e(y,f,p)}else if(i.includes("room-emmanuel")){const{initRoom1:e}=await d(async()=>{const{initRoom1:t}=await import("./room-emmanuel-Oi15Ig5k.js");return{initRoom1:t}},[]);e(y,f,p)}else if(i.includes("room-faithful")){const{initRoom3:e}=await d(async()=>{const{initRoom3:t}=await import("./room-faithful-BtWxJPkK.js");return{initRoom3:t}},[]);e(y,f,p)}else if(i.includes("room-joy")){const{initRoom4:e}=await d(async()=>{const{initRoom4:t}=await import("./room-joy-C5F5X44t.js");return{initRoom4:t}},[]);e(y,f,p)}}catch(e){console.error("Failed to initialize room:",e)}}$();export{d as _};
