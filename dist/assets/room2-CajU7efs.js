(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const d=document.getElementById("canvas");if(!d)throw new Error("Canvas element not found");const o=d.getContext("2d");if(!o)throw new Error("2D context unavailable");const v=document.getElementById("angel"),w=document.getElementById("host"),E=document.getElementById("lyrics-box"),u=document.getElementById("lyrics-text"),a=document.getElementById("carol-audio"),P=document.getElementById("media-bar"),L=document.getElementById("time-display");if(!v||!w||!E||!u||!a||!P||!L)throw new Error("Required DOM elements are missing");function B(){d.width=window.innerWidth,d.height=window.innerHeight}B();window.addEventListener("resize",B);class T{x;y;size;twinklePhase;twinkleSpeed;constructor(t,n){this.x=t,this.y=n,this.size=1.5+Math.random()*1.5,this.twinklePhase=Math.random()*Math.PI*2,this.twinkleSpeed=.02+Math.random()*.03}update(){this.twinklePhase+=this.twinkleSpeed}draw(){const t=Math.sin(this.twinklePhase)*.5+.5;o.fillStyle=`rgba(255, 255, 255, ${t})`,o.beginPath(),o.arc(this.x,this.y,this.size,0,Math.PI*2),o.fill();const n=o.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size*3);n.addColorStop(0,`rgba(255, 255, 255, ${(t-.5)*.3})`),n.addColorStop(1,"rgba(255, 255, 255, 0)"),o.fillStyle=n,o.beginPath(),o.arc(this.x,this.y,this.size*3,0,Math.PI*2),o.fill()}}const I=[];for(let e=0;e<25;e+=1){const t=Math.random()*d.width,n=Math.random()*(d.height*.5);I.push(new T(t,n))}function M(){o.clearRect(0,0,d.width,d.height),I.forEach(e=>{e.update(),e.draw()}),requestAnimationFrame(M)}M();const O=[v,w];let c=null,S=0,k=0;function C(e){if("touches"in e&&e.touches.length)return{x:e.touches[0].clientX,y:e.touches[0].clientY};const t=e;return{x:t.clientX,y:t.clientY}}function b(e,t){const n=C(e);c=t;const s=t.getBoundingClientRect();S=n.x-s.left,k=n.y-s.top,t.style.transition="none",document.addEventListener("mousemove",m),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("mouseup",f),document.addEventListener("touchend",f)}function m(e){if(!c)return;const t=C(e);c.style.left=`${t.x-S}px`,c.style.top=`${t.y-k}px`,"preventDefault"in e&&e.preventDefault()}function f(){c&&(c.style.transition=""),c=null,document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",f),document.removeEventListener("touchend",f)}O.forEach(e=>{e.addEventListener("mousedown",t=>b(t,e)),e.addEventListener("touchstart",t=>b(t,e))});const l=[{start:4,line:"Hark! The herald angels sing"},{start:11,line:"Glory to the new-born King"},{start:17,line:"Peace on earth and mercy mild"},{start:23,line:"God and sinners reconciled"},{start:29,line:"Joyful all ye nations rise"},{start:35,line:"Join the triumph of the skies"},{start:41,line:"With angelic host proclaim"},{start:47,line:"Christ is born in Bethlehem"},{start:53,line:"Hark! The herald angels sing"},{start:58,line:"Glory to the new-born King"},{start:75,line:"Christ, by highest heaven adored"},{start:80,line:"Christ, the everlasting Lord"},{start:87,line:"Late in time behold him come"},{start:93,line:"Offspring of a virgin's womb"},{start:99,line:"Veiled in flesh the Godhead see"},{start:105,line:"Hail the incarnate Deity"},{start:111,line:"Pleased with us in flesh to dwell"},{start:117,line:"Jesus, our Immanuel"},{start:122,line:"Hark! The herald angels sing"},{start:128,line:"Glory to the new-born king"},{start:156,line:"Hail the heaven-born Prince of Peace"},{start:162,line:"Hail the Son of Righteousness"},{start:168,line:"Light and life to all He brings"},{start:174,line:"Risen with healing in His wings"},{start:180,line:"Mild He lays His glory by"},{start:186,line:"Born that man no more may die"},{start:192,line:"Born to raise the sons of earth"},{start:198,line:"Born to give them second birth"},{start:204,line:"Hark! The herald angels sing"},{start:210,line:"Glory to the new-born king"}];function D(e){if(typeof e=="number")return e;const t=e.split(":");if(t.length===2){const n=parseInt(t[0],10),s=parseInt(t[1],10);return n*60+s}return parseInt(e,10)}function p(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}for(let e=0;e<l.length;e+=1)l[e].start=D(l[e].start);let x=!1,y=0,h=0;function H(e){u.children.length===0&&l.forEach(t=>{const n=document.createElement("div");n.className="lyric-line",n.textContent=t.line,u.appendChild(n)}),l.forEach((t,n)=>{const s=u.children[n];s.classList.remove("prev","current","next","next-2","hidden-above","hidden-below");const i=n-e;i===-1?s.classList.add("prev"):i===0?s.classList.add("current"):i===1?s.classList.add("next"):i===2?s.classList.add("next-2"):i>2?s.classList.add("hidden-below"):i<-1&&s.classList.add("hidden-above")})}function $(e){let t=h;for(;t+1<l.length&&e>=l[t+1].start;)t+=1;for(;t>0&&e<l[t].start;)t-=1;t!==h&&(h=t,H(h))}a.addEventListener("timeupdate",()=>{$(a.currentTime);const e=p(a.currentTime),t=p(a.duration||0);L.textContent=`${e} / ${t}`});a.addEventListener("loadedmetadata",()=>{const e=p(a.duration||0);L.textContent=`00:00 / ${e}`});E.addEventListener("click",e=>e.stopPropagation());P.addEventListener("click",e=>e.stopPropagation());document.addEventListener("click",()=>{if(y+=1,y===1){v.classList.add("show"),w.classList.add("show");return}y===2&&!x&&(x=!0,E.classList.add("show"),a.play().catch(()=>{}))});H(h);
